<footer class="footer">
  <span>@Cyborg Candidate</span>
</footer>

{{- partial "extend_footer.html" . }}

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });
</script>

<!-- å½©è›‹ï¼šé›¨å¤œ + é—ªç”µ + è™è  -->
<div id="rain-container"></div>
<div id="lightning"></div>
<div id="bat">ğŸ¦‡</div>

<!-- å½©è›‹ï¼šé˜³å…‰ + å°˜åŸƒ + å¤ªé˜³ -->
<div id="sunshine-container"></div>
<div id="sun-rays"></div>
<div id="sun">â˜€ï¸</div>

{{- if (not site.Params.disableThemeToggle) }}
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
            stopRain();
            startSunshine();
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
            stopSunshine();
            startRain();
        }
    })

    // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ä¸»é¢˜
    if (document.querySelector("html").dataset.theme === "dark") {
        startRain();
    } else if (document.querySelector("html").dataset.theme === "light") {
        startSunshine();
    }

    // ===== æš—é»‘æ¨¡å¼ï¼šé›¨å¤œ =====
    function startRain() {
        const container = document.getElementById('rain-container');
        container.innerHTML = '';
        container.style.display = 'block';

        for (let i = 0; i < 100; i++) {
            const drop = document.createElement('div');
            drop.className = 'rain-drop';
            drop.style.left = Math.random() * 100 + '%';
            drop.style.animationDuration = (Math.random() * 0.5 + 0.3) + 's';
            drop.style.animationDelay = Math.random() * 2 + 's';
            container.appendChild(drop);
        }

        triggerLightning();
        window.lightningInterval = setInterval(triggerLightning, 5000 + Math.random() * 5000);

        // é›¨æ»´æº…å°„æ•ˆæœ
        startSplashEffect();
    }

    function startSplashEffect() {
        const posts = document.querySelectorAll('.first-entry, article');
        if (posts.length === 0) return;

        window.splashInterval = setInterval(() => {
            posts.forEach(post => {
                if (Math.random() > 0.7) {
                    createSplash(post);
                }
            });
        }, 500);
    }

    function createSplash(element) {
        const rect = element.getBoundingClientRect();
        const splash = document.createElement('div');
        splash.className = 'rain-splash';
        splash.style.left = (rect.left + Math.random() * rect.width) + 'px';
        splash.style.top = rect.top + 'px';
        document.body.appendChild(splash);

        setTimeout(() => splash.remove(), 600);
    }

    function stopRain() {
        const container = document.getElementById('rain-container');
        container.style.display = 'none';
        container.innerHTML = '';
        clearInterval(window.lightningInterval);
        clearInterval(window.splashInterval);
        document.getElementById('lightning').style.opacity = '0';
        document.getElementById('bat').style.opacity = '0';
        // æ¸…é™¤æ®‹ç•™çš„æº…å°„æ•ˆæœ
        document.querySelectorAll('.rain-splash').forEach(el => el.remove());
    }

    function triggerLightning() {
        const lightning = document.getElementById('lightning');
        const bat = document.getElementById('bat');

        lightning.style.opacity = '1';
        bat.style.opacity = '1';

        setTimeout(() => {
            lightning.style.opacity = '0';
            bat.style.opacity = '0';
        }, 100);

        setTimeout(() => {
            lightning.style.opacity = '0.7';
            bat.style.opacity = '1';
        }, 200);

        setTimeout(() => {
            lightning.style.opacity = '0';
            bat.style.opacity = '0';
        }, 300);
    }

    // ===== ç™½å¤©æ¨¡å¼ï¼šé˜³å…‰ =====
    function startSunshine() {
        const container = document.getElementById('sunshine-container');
        const sunRays = document.getElementById('sun-rays');
        const sun = document.getElementById('sun');

        container.innerHTML = '';
        container.style.display = 'block';
        sunRays.style.display = 'block';
        sun.style.opacity = '1';

        // åˆ›å»ºæ¼‚æµ®çš„é‡‘è‰²å°˜åŸƒç²’å­
        for (let i = 0; i < 50; i++) {
            const dust = document.createElement('div');
            dust.className = 'dust-particle';
            dust.style.left = Math.random() * 100 + '%';
            dust.style.top = Math.random() * 100 + '%';
            dust.style.animationDuration = (Math.random() * 3 + 2) + 's';
            dust.style.animationDelay = Math.random() * 2 + 's';
            container.appendChild(dust);
        }
    }

    function stopSunshine() {
        const container = document.getElementById('sunshine-container');
        const sunRays = document.getElementById('sun-rays');
        const sun = document.getElementById('sun');

        container.style.display = 'none';
        container.innerHTML = '';
        sunRays.style.display = 'none';
        sun.style.opacity = '0';
    }
</script>
{{- end }}
